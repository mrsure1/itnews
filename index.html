<!doctype html>
<html lang="ko" class="scroll-smooth">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MrSure IT News</title>
  <meta name="description" content="국내외 핵심 기술 트렌드를 한눈에. AI가 엄선한 최신 IT 테크 뉴스.">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            display: ["Space Grotesk", "ui-sans-serif", "system-ui"],
            body: ["IBM Plex Sans KR", "ui-sans-serif", "system-ui"],
          },
        },
      },
    };
  </script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root { --bg-color: #f8fafc; }

    body {
      background-color: var(--bg-color);
      background-image:
        radial-gradient(at 0% 0%, rgba(59,130,246,0.08) 0px, transparent 50%),
        radial-gradient(at 100% 100%, rgba(139,92,246,0.08) 0px, transparent 50%);
      color: #0f172a;
      font-family: 'IBM Plex Sans KR', sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    header h1 { font-family: 'Space Grotesk', sans-serif; }

    /* 카드 호버 */
    .news-card {
      transition: transform 200ms cubic-bezier(0.4,0,0.2,1), box-shadow 200ms, border-color 200ms;
    }
    .news-card:hover { transform: translateY(-3px); }

    /* ──────────────────────────────
       슬라이드 뷰포트 & 애니메이션
    ────────────────────────────── */
    .news-viewport {
      overflow: hidden;
      position: relative;
    }

    .news-grid-wrap {
      /* will-change: transform; */
    }

    @keyframes slideInLeft  { from { opacity:0; transform:translateX(-60px); } to { opacity:1; transform:translateX(0); } }
    @keyframes slideInRight { from { opacity:0; transform:translateX( 60px); } to { opacity:1; transform:translateX(0); } }
    @keyframes slideOutLeft { from { opacity:1; transform:translateX(0);     } to { opacity:0; transform:translateX(-60px); } }
    @keyframes slideOutRight{ from { opacity:1; transform:translateX(0);     } to { opacity:0; transform:translateX( 60px); } }

    .slide-in-left  { animation: slideInLeft  .35s cubic-bezier(.4,0,.2,1) forwards; }
    .slide-in-right { animation: slideInRight .35s cubic-bezier(.4,0,.2,1) forwards; }

    /* 페이지네이션 바 */
    .pagination-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 20px 0 4px;
    }

    .page-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px; height: 40px;
      border-radius: 50%;
      border: 1.5px solid #e2e8f0;
      background: #fff;
      color: #475569;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all .18s;
    }
    .page-btn:hover:not(:disabled) {
      background: #3b82f6;
      border-color: #3b82f6;
      color: #fff;
      box-shadow: 0 4px 14px rgba(59,130,246,.35);
    }
    .page-btn:disabled { opacity: .35; cursor: default; }
    .page-btn.active {
      background: #3b82f6;
      border-color: #3b82f6;
      color: #fff;
      box-shadow: 0 4px 14px rgba(59,130,246,.35);
    }

    /* 글로벌 페이지 버튼 강조색 */
    section#globalSection .page-btn.active,
    section#globalSection .page-btn:hover:not(:disabled) {
      background: #7c3aed;
      border-color: #7c3aed;
      box-shadow: 0 4px 14px rgba(124,58,237,.35);
    }

    .page-info {
      font-size: 13px;
      color: #94a3b8;
      font-variant-numeric: tabular-nums;
      min-width: 80px;
      text-align: center;
    }

    /* 날짜 탭 */
    .date-tab {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 14px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      border: 1.5px solid #e2e8f0;
      background: #fff;
      color: #64748b;
      cursor: pointer;
      white-space: nowrap;
      transition: all .18s;
    }
    .date-tab:hover { border-color: #3b82f6; color: #3b82f6; }
    .date-tab.selected {
      background: #eff6ff;
      border-color: #93c5fd;
      color: #2563eb;
    }

    /* 스크롤바 */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fadeIn .5s ease-out forwards; }
  </style>
</head>

<body class="min-h-screen selection:bg-blue-100 selection:text-blue-900">
  <main class="w-full max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">

    <!-- 헤더 -->
    <header class="mb-12 animate-fade-in">
      <div class="mb-3">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-semibold border border-blue-100">
          <span class="relative flex h-2 w-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
          </span>
          Daily Tech Update
        </div>
      </div>

      <div class="rounded-xl overflow-hidden shadow-lg border border-slate-200/60 relative" style="min-height:180px;">
        <div class="absolute inset-0 bg-gradient-to-br from-blue-500 via-violet-500 to-purple-600"></div>
        <div class="absolute inset-0 opacity-30" style="background-image:repeating-linear-gradient(45deg,transparent,transparent 35px,rgba(255,255,255,.1) 35px,rgba(255,255,255,.1) 70px),repeating-linear-gradient(-45deg,transparent,transparent 35px,rgba(255,255,255,.1) 35px,rgba(255,255,255,.1) 70px);"></div>
        <div class="relative h-full flex flex-col items-center justify-center text-white px-6 py-8">
          <div class="flex items-center justify-center gap-3 mb-3">
            <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/></svg>
            <h1 class="text-4xl md:text-5xl font-bold tracking-tight">IT News <span class="font-light opacity-90">Hub</span></h1>
          </div>
          <p class="text-blue-50 text-sm md:text-base max-w-2xl mx-auto text-center mb-4">국내외 핵심 기술 트렌드를 한눈에 파악하세요. <span class="hidden sm:inline">AI가 엄선한 테크 뉴스를 실시간으로 제공합니다.</span></p>
          <div class="flex flex-col sm:flex-row items-center gap-2 text-xs">
            <div id="lastUpdated" class="font-mono bg-white/20 backdrop-blur-sm px-3 py-1.5 rounded-md border border-white/30">Updating...</div>
            <p class="text-blue-100 text-[11px]">7일치 보관 · 자동 업데이트</p>
          </div>
        </div>
        <div class="absolute top-4 left-4 w-2 h-2 bg-white rounded-full animate-ping"></div>
        <div class="absolute bottom-4 right-4 w-2 h-2 bg-white rounded-full animate-ping" style="animation-delay:.5s;"></div>
      </div>
    </header>

    <!-- 날짜 필터 -->
    <div id="dateTabs" class="flex flex-wrap gap-2 mb-10 items-center">
      <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider mr-1">날짜별 보기</span>
    </div>

    <div class="space-y-0">
      <!-- ── 국내 뉴스 ── -->
      <section class="animate-fade-in pb-12" style="animation-delay:100ms;">
        <div class="flex items-center gap-4 mb-6 border-l-4 border-blue-500 pl-4">
          <div>
            <h2 class="font-display text-2xl font-bold text-slate-800">Korea Tech</h2>
            <p class="text-sm text-slate-500 font-medium">국내 최신 기술 동향</p>
          </div>
          <span id="koreaTotalBadge" class="ml-auto text-xs font-mono bg-blue-50 text-blue-600 border border-blue-100 px-2 py-1 rounded-full"></span>
        </div>

        <div class="news-viewport">
          <div id="koreaList" class="news-grid-wrap grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6">
            <div class="animate-pulse col-span-full h-64 bg-slate-100 rounded-xl border border-slate-200"></div>
          </div>
        </div>

        <div class="pagination-bar" id="koreaPagination"></div>
      </section>

      <!-- ── 해외 뉴스 ── -->
      <section id="globalSection" class="-mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8 py-12 bg-gradient-to-br from-slate-100 via-gray-100 to-slate-150 border-y border-slate-200">
        <div class="flex items-center gap-4 mb-6 border-l-4 border-violet-500 pl-4">
          <div>
            <h2 class="font-display text-2xl font-bold text-slate-800">Global Tech</h2>
            <p class="text-sm text-slate-500 font-medium">해외 주요 이슈 (AI 요약)</p>
          </div>
          <span id="globalTotalBadge" class="ml-auto text-xs font-mono bg-violet-50 text-violet-600 border border-violet-100 px-2 py-1 rounded-full"></span>
        </div>

        <div class="news-viewport">
          <div id="globalList" class="news-grid-wrap grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6">
            <div class="animate-pulse col-span-full h-64 bg-slate-100 rounded-xl border border-slate-200"></div>
          </div>
        </div>

        <div class="pagination-bar" id="globalPagination"></div>
      </section>
    </div>

    <!-- 푸터 -->
    <footer class="mt-20 pt-10 border-t border-slate-200">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-slate-500">
        <p class="font-medium">Powered by MrSure Agent · 7일치 뉴스 보관</p>
        <div class="flex gap-4">
          <span>Naver News</span><span>TechCrunch</span><span>The Verge</span><span>Wired</span><span>Hacker News</span>
        </div>
      </div>
      <p id="fetchHint" class="hidden mt-4 text-xs font-mono text-red-500 bg-red-50 p-2 rounded text-center">
        ⚠️ Fetch Error: 로컬 파일 직접 열기 제한. <code>python -m http.server</code> 실행 후 localhost 접속 권장.
      </p>
    </footer>
  </main>

  <!-- news_data.js 동적 로드 -->
  <script>
    (function () {
      const script = document.createElement('script');
      script.src = "news_data.js?t=" + new Date().getTime();
      script.onload = () => { if (typeof initApp === 'function') initApp(); };
      script.onerror = () => { if (typeof initApp === 'function') initApp(); };
      document.body.appendChild(script);
    })();
  </script>

  <script>
    /* =============================================
       유틸리티
    ============================================= */
    const $ = (id) => document.getElementById(id);

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;").replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;").replaceAll('"', "&quot;").replaceAll("'", "&#039;");
    }

    function getFallbackGradient(title) {
      const gs = [
        "from-blue-400 to-indigo-500","from-violet-400 to-purple-500",
        "from-cyan-400 to-blue-500","from-emerald-400 to-teal-500","from-rose-400 to-pink-500"
      ];
      return gs[title.length % gs.length];
    }

    /* =============================================
       카드 HTML 생성
    ============================================= */
    function makeNewsItem(item, type) {
      const media      = item["매체"]   ?? item.media    ?? "Unknown";
      const title      = item["제목"]   ?? item.title    ?? "Untitled";
      const collected  = item["수집일시"] ?? item.collected_at ?? "";
      const dateStr    = collected.split(' ')[0].replace(/-/g, '.');
      const link       = item["링크"]   ?? item.link     ?? "#";
      const summary    = item["요약"]   ?? item.summary  ?? "";
      const imageUrl   = item["이미지"] ?? item.image    ?? "";
      const isKorea    = type === 'korea';

      const theme = isKorea
        ? { badge:"bg-blue-50 text-blue-700 border-blue-100", hover:"group-hover:text-blue-600", bHover:"hover:border-blue-200 hover:shadow-blue-500/5" }
        : { badge:"bg-violet-50 text-violet-700 border-violet-100", hover:"group-hover:text-violet-600", bHover:"hover:border-violet-200 hover:shadow-violet-500/5" };

      const titleHtml   = isKorea ? escapeHtml(title) : `<span class="js-ko-title">${escapeHtml(title)}</span>`;
      const summaryHtml = summary
        ? `<p class="text-sm text-slate-600 leading-relaxed line-clamp-3">${isKorea ? escapeHtml(summary) : `<span class="js-ko-summary">${escapeHtml(summary)}</span>`}</p>`
        : '';

      const imageHtml = imageUrl
        ? `<div class="w-full h-48 relative overflow-hidden bg-slate-100 border-b border-slate-200">
             <img src="${imageUrl}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" loading="lazy"
               onerror="this.parentNode.innerHTML=\`<div class='w-full h-full bg-gradient-to-br ${getFallbackGradient(title)} flex items-center justify-center'><svg class='w-10 h-10 text-white/50' fill='none' stroke='currentColor' viewBox='0 0 24 24'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z'></path></svg></div>\`">
           </div>`
        : `<div class="w-full h-48 bg-gradient-to-br ${getFallbackGradient(title)} flex items-center justify-center border-b border-slate-200">
             <svg class="w-10 h-10 text-white/50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
           </div>`;

      return `<a href="${link}" target="_blank" rel="noopener noreferrer"
         class="news-card group flex flex-col bg-white rounded-xl border border-slate-200 shadow-[0_2px_8px_rgba(0,0,0,0.02)] ${theme.bHover} overflow-hidden h-full transition-all duration-300 hover:shadow-lg">
        ${imageHtml}
        <div class="flex-1 p-4 flex flex-col">
          <div class="flex items-center justify-between mb-3">
            <span class="text-[10px] uppercase tracking-wider font-bold px-2 py-1 rounded-md border ${theme.badge}">${escapeHtml(media)}</span>
            <span class="text-[10px] font-mono text-slate-400">${dateStr}</span>
          </div>
          <h3 class="text-base font-bold text-slate-800 leading-snug mb-2 ${theme.hover} transition-colors line-clamp-2">${titleHtml}</h3>
          ${summaryHtml}
          <div class="mt-auto pt-3 flex items-center gap-2 text-slate-400 group-hover:text-blue-600 transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
            <span class="text-xs font-medium">자세히 보기</span>
          </div>
        </div>
      </a>`;
    }

    /* =============================================
       번역 로직
    ============================================= */
    const _trCache = new Map();
    let _trQueue = [], _trInFlight = 0;
    const _trMax = 4;

    function hasHangul(t) { return /[가-힣]/.test(t); }

    function enqueueTranslation(text, el) {
      if (!text) return;
      if (hasHangul(text) && text.length < 50) { el.textContent = text; return; }
      const cached = _trCache.get(text) || localStorage.getItem(`tr:${text}`);
      if (cached) { el.textContent = cached; return; }
      _trQueue.push({ text, el });
      drainQueue();
    }

    async function drainQueue() {
      if (_trInFlight >= _trMax || !_trQueue.length) return;
      const job = _trQueue.shift();
      _trInFlight++;
      try {
        const ko = await translateEnToKo(job.text);
        if (ko) {
          job.el.style.opacity = '0';
          setTimeout(() => { job.el.textContent = ko; job.el.style.transition = 'opacity .3s'; job.el.style.opacity = '1'; }, 100);
        }
      } catch(e) {} finally { _trInFlight--; drainQueue(); }
    }

    async function translateEnToKo(text) {
      const cached = _trCache.get(text) || localStorage.getItem(`tr:${text}`);
      if (cached) return cached;
      const url = new URL("https://translate.googleapis.com/translate_a/single");
      url.search = new URLSearchParams({ client:"gtx", sl:"auto", tl:"ko", dt:"t", q:text });
      const res = await fetch(url.toString());
      if (!res.ok) throw new Error();
      const data = await res.json();
      const out = Array.isArray(data?.[0]) ? data[0].map(x=>x?.[0]).join('') : text;
      _trCache.set(text, out);
      try { localStorage.setItem(`tr:${text}`, out); } catch {}
      return out;
    }

    /* =============================================
       페이지네이션 상태
    ============================================= */
    const ITEMS_PER_KOREA  = 10;
    const ITEMS_PER_GLOBAL = 20;

    const state = {
      korea:  { page: 0, items: [], perPage: ITEMS_PER_KOREA  },
      global: { page: 0, items: [], perPage: ITEMS_PER_GLOBAL },
    };

    /* =============================================
       페이지 렌더 (슬라이드 애니메이션 포함)
    ============================================= */
    function renderPage(sectionKey, direction) {
      const s      = state[sectionKey];
      const listEl = $(sectionKey === 'korea' ? 'koreaList' : 'globalList');
      const type   = sectionKey === 'korea' ? 'korea' : 'global';

      const start  = s.page * s.perPage;
      const end    = Math.min(start + s.perPage, s.items.length);
      const slice  = s.items.slice(start, end);

      // 슬라이드 방향 결정
      const inClass = direction === 'next' ? 'slide-in-right' : 'slide-in-left';

      listEl.style.opacity = '0';
      listEl.style.transform = direction === 'next' ? 'translateX(40px)' : 'translateX(-40px)';

      setTimeout(() => {
        listEl.innerHTML = slice.length
          ? slice.map(item => makeNewsItem(item, type)).join('')
          : `<div class="p-8 text-center text-slate-400 bg-slate-50 rounded-xl border border-dashed border-slate-200 col-span-full">뉴스가 없습니다.</div>`;

        listEl.style.transition = 'opacity .35s cubic-bezier(.4,0,.2,1), transform .35s cubic-bezier(.4,0,.2,1)';
        listEl.style.transform = 'translateX(0)';
        listEl.style.opacity = '1';

        // 번역 큐 등록
        listEl.querySelectorAll('.js-ko-title').forEach(el => enqueueTranslation(el.textContent, el));
        listEl.querySelectorAll('.js-ko-summary').forEach(el => enqueueTranslation(el.textContent, el));
      }, 120);

      renderPagination(sectionKey);
    }

    /* =============================================
       페이지네이션 바 렌더
    ============================================= */
    function renderPagination(sectionKey) {
      const s       = state[sectionKey];
      const pEl     = $(sectionKey === 'korea' ? 'koreaPagination' : 'globalPagination');
      const total   = Math.ceil(s.items.length / s.perPage);
      const current = s.page;

      if (total <= 1) { pEl.innerHTML = ''; return; }

      let btnHtml = `
        <button class="page-btn" id="${sectionKey}Prev" ${current === 0 ? 'disabled' : ''} onclick="changePage('${sectionKey}','prev')">
          <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"/></svg>
        </button>`;

      // 페이지 버튼 (최대 7개 표시)
      let start = Math.max(0, current - 3);
      let end   = Math.min(total - 1, start + 6);
      if (end - start < 6) start = Math.max(0, end - 6);

      if (start > 0) btnHtml += `<button class="page-btn" onclick="jumpPage('${sectionKey}', 0)">1</button><span class="text-slate-300 text-sm">…</span>`;

      for (let i = start; i <= end; i++) {
        btnHtml += `<button class="page-btn ${i === current ? 'active' : ''}" onclick="jumpPage('${sectionKey}', ${i})">${i + 1}</button>`;
      }

      if (end < total - 1) btnHtml += `<span class="text-slate-300 text-sm">…</span><button class="page-btn" onclick="jumpPage('${sectionKey}', ${total-1})">${total}</button>`;

      btnHtml += `
        <button class="page-btn" id="${sectionKey}Next" ${current === total - 1 ? 'disabled' : ''} onclick="changePage('${sectionKey}','next')">
          <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"/></svg>
        </button>
        <span class="page-info">${current + 1} / ${total} 페이지</span>`;

      pEl.innerHTML = btnHtml;
    }

    function changePage(sectionKey, dir) {
      const s     = state[sectionKey];
      const total = Math.ceil(s.items.length / s.perPage);
      const prev  = s.page;
      if (dir === 'next' && s.page < total - 1) s.page++;
      else if (dir === 'prev' && s.page > 0) s.page--;
      if (s.page !== prev) renderPage(sectionKey, dir);
    }

    function jumpPage(sectionKey, page) {
      const s = state[sectionKey];
      if (page === s.page) return;
      const dir = page > s.page ? 'next' : 'prev';
      s.page = page;
      renderPage(sectionKey, dir);
    }

    /* =============================================
       날짜 필터
    ============================================= */
    let allKorea = [], allGlobal = [];
    let selectedDate = 'all';

    function getUniqueDates(items) {
      const set = new Set();
      items.forEach(item => {
        const d = (item.collected_at || item["수집일시"] || "").split(' ')[0];
        if (d) set.add(d);
      });
      return [...set].sort().reverse();
    }

    function buildDateTabs(items) {
      const dates = getUniqueDates(items);
      const tabEl = $('dateTabs');
      if (!tabEl) return;

      let html = `<span class="text-xs font-semibold text-slate-400 uppercase tracking-wider mr-1">날짜별 보기</span>
        <button class="date-tab ${selectedDate === 'all' ? 'selected' : ''}" onclick="filterDate('all')">전체</button>`;

      const labels = ['오늘','어제','2일 전','3일 전','4일 전','5일 전','6일 전'];
      dates.forEach((d, i) => {
        const label = labels[i] ? `${labels[i]} (${d.slice(5)})` : d;
        html += `<button class="date-tab ${selectedDate === d ? 'selected' : ''}" onclick="filterDate('${d}')">${label}</button>`;
      });

      tabEl.innerHTML = html;
    }

    function filterDate(date) {
      selectedDate = date;

      const filtered = (arr) => date === 'all' ? arr : arr.filter(item => {
        const d = (item.collected_at || item["수집일시"] || "").split(' ')[0];
        return d === date;
      });

      state.korea.items  = filtered(allKorea);
      state.global.items = filtered(allGlobal);
      state.korea.page   = 0;
      state.global.page  = 0;

      $('koreaTotalBadge').textContent  = `총 ${state.korea.items.length}건`;
      $('globalTotalBadge').textContent = `총 ${state.global.items.length}건`;

      renderPage('korea', 'next');
      renderPage('global', 'next');

      // 탭 갱신
      document.querySelectorAll('.date-tab').forEach(btn => {
        const match = btn.getAttribute('onclick')?.includes(`'${date}'`);
        btn.classList.toggle('selected', !!match);
      });
    }

    /* =============================================
       메인 진입
    ============================================= */
    async function initApp() {
      try {
        let data = [];
        if (window.NEWS_DATA && Array.isArray(window.NEWS_DATA)) {
          data = window.NEWS_DATA;
        } else {
          const res = await fetch("news_data.json", { cache: "no-store" });
          if (!res.ok) throw new Error("fetch failed");
          data = await res.json();
        }

        const norm = (x) => String(x["국가"] ?? x.country ?? "").trim().toLowerCase();
        allKorea  = data.filter(x => ["국내","domestic","korea","kr"].includes(norm(x)));
        allGlobal = data.filter(x => ["미국","global","us","usa"].includes(norm(x)));

        // 최신 업데이트 시간
        const times = data.map(x => x["수집일시"] ?? x.collected_at).filter(Boolean).sort();
        if (times.length) $("lastUpdated").textContent = `Last update: ${times[times.length - 1]}`;

        buildDateTabs(data);

        state.korea.items  = allKorea;
        state.global.items = allGlobal;

        $('koreaTotalBadge').textContent  = `총 ${allKorea.length}건`;
        $('globalTotalBadge').textContent = `총 ${allGlobal.length}건`;

        renderPage('korea', 'next');
        renderPage('global', 'next');

      } catch (err) {
        console.error(err);
        $("fetchHint").classList.remove("hidden");
        $("koreaList").innerHTML  = `<div class="p-4 bg-red-50 text-red-500 rounded-lg">데이터를 불러오지 못했습니다.</div>`;
        $("globalList").innerHTML = `<div class="p-4 bg-red-50 text-red-500 rounded-lg">데이터를 불러오지 못했습니다.</div>`;
      }
    }
  </script>
</body>
</html>